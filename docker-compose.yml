# 开发环境 Docker Compose 配置
# 包含 MongoDB, Redis 和应用服务

version: '3.8'

services:
  # MongoDB 服务
  mongodb:
    image: mongo:6.0
    container_name: nextadmin-mongodb
    restart: always
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: ${MONGODB_PASSWORD:-changeme}
      MONGO_INITDB_DATABASE: NextAdmin
    volumes:
      - mongodb_data:/data/db
      - mongodb_config:/data/configdb
    networks:
      - nextadmin-network

  # Redis 服务
  redis:
    image: redis:7-alpine
    container_name: nextadmin-redis
    restart: always
    ports:
      - "6379:6379"
    command: redis-server --requirepass ${REDIS_PASSWORD:-changeme}
    volumes:
      - redis_data:/data
    networks:
      - nextadmin-network

  # API 服务（可选，用于开发）
  # api:
  #   build:
  #     context: .
  #     dockerfile: src/API/Dockerfile
  #   container_name: nextadmin-api
  #   restart: always
  #   ports:
  #     - "5000:8080"
  #   environment:
  #     - ASPNETCORE_ENVIRONMENT=Development
  #     - MongoDb__ConnectionString=mongodb://admin:${MONGODB_PASSWORD:-changeme}@mongodb:27017/NextAdmin?authSource=admin
  #     - ConnectionStrings__Redis=redis:6379,password=${REDIS_PASSWORD:-changeme}
  #     - Jwt__SecretKey=${JWT_SECRET_KEY}
  #   depends_on:
  #     - mongodb
  #     - redis
  #   networks:
  #     - nextadmin-network

volumes:
  mongodb_data:
    driver: local
  mongodb_config:
    driver: local
  redis_data:
    driver: local

networks:
  nextadmin-network:
    driver: bridge
